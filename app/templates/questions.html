<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Impossible Test</title>
    <link href="{{url_for('static', filename='styles/style.css')}}" rel="stylesheet" />
</head>
<body>
    <header>
        <h1 class="page-title">임파서블 - 파서블 테스트</h1>
        <p class="page-description"></p>
    </header>
    <div class="page-body">
        <div id="question">질문1</div>
        <div id="buttons" style="display: block;">
            <button id="pos">가능</button>
            <button id="impos">불가능</button>
        </div>
        <div id="resultPage" style="display: none;">
            <button onclick="sendResult()">결과 제출</button> 
        </div>
    </div>
    <script>
        const questions = [
        "예시1",
        "예시2",
        "예시3",
        "예시4",
        "예시5",
        ];
        const questionElement = document.getElementById("question");
        const buttonsElement = document.getElementById("buttons");
        const resultPageElement = document.getElementById("resultPage");
        let currentQuestionIndex = 0;
        let userAnswers = [];
    
        function showQuestion() {
        if (currentQuestionIndex < questions.length) {
            questionElement.innerText = questions[currentQuestionIndex];
            buttonsElement.style.display = "block";
            resultPageElement.style.display = "none";
        } else {
            questionElement.innerText = "임파서블 테스트가 종료되었습니다.";
            buttonsElement.style.display = "none";
            resultPageElement.style.display = "block";
        }
        }
        showQuestion();
    
        document.getElementById("pos").addEventListener("click", () => {
        userAnswers[currentQuestionIndex] = 1;
        currentQuestionIndex++;
        showQuestion();
        });
    
        document.getElementById("impos").addEventListener("click", () => {
        userAnswers[currentQuestionIndex] = 0;
        currentQuestionIndex++;
        showQuestion();
        });
    
    
    // 결과값을 서버로 전송하는 함수
    async function sendResult() {
        const answers = questions.map((_, index) => ({
            question_id: index + 1, // 실제 애플리케이션에서는 질문 ID를 올바르게 지정해야 합니다.
            chosen_answer: userAnswers[index]
        }));
        try {
            const response = await fetch("/submit", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ answers }) // 수정: answers 객체를 직접 전송
            });
            if (!response.ok) throw new Error("서버 응답 실패");
            console.log("결과 전송 완료");
            window.location.href = "/results";
        } catch (error) {
            console.error("오류 발생:", error);
        }
    }
    </script>
</body>
</html>